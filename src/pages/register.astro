---
import Layout from "../layouts/Layout.astro";
---

<Layout>
    <div class="max-w-md mt-20 mx-auto p-6 text-black">
        <h1 class="text-2xl font-bold mb-4">Créer un compte</h1>

        <form
            id="register-form"
            class="flex flex-col gap-4"
            enctype="multipart/form-data"
        >
            <input
                type="email"
                name="email"
                placeholder="Email"
                required
                class="p-2 border"
            />
            <input
                type="password"
                name="password"
                placeholder="Mot de passe"
                required
                class="p-2 border"
            />
            <input
                type="text"
                name="pseudo"
                placeholder="Pseudo"
                required
                class="p-2 border"
            />
            <input type="file" name="avatar" accept="image/*" class="p-2" />

            <button
                type="submit"
                class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700"
            >
                Créer mon compte
            </button>
        </form>
    </div>

    <script is:browser>
        const form = document.getElementById("register-form");

        form.addEventListener("submit", async (e) => {
            e.preventDefault();

            const formData = new FormData(form);
            const res = await fetch("/api/register", {
                method: "POST",
                body: formData,
            });

            const result = await res.json();

            if (res.ok) {
                localStorage.setItem("user", JSON.stringify(result.user));
                alert("Compte créé avec succès !");
                window.location.href = "/"; // redirection post-inscription
            } else {
                alert(result.error || "Erreur lors de l'inscription.");
            }
        });
    </script>
</Layout>
