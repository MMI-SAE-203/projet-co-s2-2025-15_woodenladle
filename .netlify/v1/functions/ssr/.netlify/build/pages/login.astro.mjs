import { e as createComponent, r as renderTemplate, m as maybeRenderHead, f as createAstro, i as renderComponent } from '../chunks/astro/server_Bqug4sl-.mjs';
import 'kleur/colors';
import { $ as $$Layout } from '../chunks/Layout_BR1mHeqF.mjs';
import 'clsx';
import { u as updateUser, d as deleteUser } from '../chunks/backend_DhH19apL.mjs';
export { renderers } from '../renderers.mjs';

var __freeze$1 = Object.freeze;
var __defProp$1 = Object.defineProperty;
var __template$1 = (cooked, raw) => __freeze$1(__defProp$1(cooked, "raw", { value: __freeze$1(cooked.slice()) }));
var _a$1;
const $$LoginForm = createComponent(async ($$result, $$props, $$slots) => {
  return renderTemplate(_a$1 || (_a$1 = __template$1(["", '<form id="loginForm" class="w-1/4 mb-15 space-y-4 text-center mx-auto mt-10"> <input type="email" name="email" placeholder="Email" required class="w-full p-2 border rounded-xl"> <div class="relative"> <input type="password" id="password" name="password" required placeholder="Mot de passe" class="w-full p-2 border rounded-xl"> <button type="button" id="togglePassword" class="absolute right-3 top-1/2 cursor-pointer transform -translate-y-1/2 text-gray-500 hover:text-gray-700"> <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" id="eyeIcon"> <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"></path> <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"></path> </svg> <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 hidden" viewBox="0 0 20 20" fill="currentColor" id="eyeSlashIcon"> <path fill-rule="evenodd" d="M3.707 2.293a1 1 0 00-1.414 1.414l14 14a1 1 0 001.414-1.414l-1.473-1.473A10.014 10.014 0 0019.542 10C18.268 5.943 14.478 3 10 3a9.958 9.958 0 00-4.512 1.074l-1.78-1.781zm4.261 4.26l1.514 1.515a2.003 2.003 0 012.45 2.45l1.514 1.514a4 4 0 00-5.478-5.478z" clip-rule="evenodd"></path> <path d="M12.454 16.697L9.75 13.992a4 4 0 01-3.742-3.741L2.335 6.578A9.98 9.98 0 00.458 10c1.274 4.057 5.065 7 9.542 7 .847 0 1.669-.105 2.454-.303z"></path> </svg> </button> </div> <button type="submit" class="font-lilitaone mt-10 uppercase text-lg hover:w-[250px] transition-all cursor-pointer mx-auto rounded-xl border-3 flex justify-center items-center h-[50px] w-[200px] hover:bg-black hover:text-white">\nSe connecter</button> <p id="error" class="text-red-500 mt-2 hidden"></p> <p class="text-gray-500">\nPas encore de compte ?\n<a href="/register" class="text-green-600 hover:underline">Cr\xE9er un compte</a> </p></form> <script is:browser>\n    const form = document.getElementById("loginForm");\n    const togglePassword = document.getElementById("togglePassword");\n    const passwordInput = document.getElementById("password");\n    const eyeIcon = document.getElementById("eyeIcon");\n    const eyeSlashIcon = document.getElementById("eyeSlashIcon");\n\n    togglePassword.addEventListener("click", () => {\n        const type = passwordInput.getAttribute("type") === "password" ? "text" : "password";\n        passwordInput.setAttribute("type", type);\n        eyeIcon.classList.toggle("hidden");\n        eyeSlashIcon.classList.toggle("hidden");\n    });\n\n    form.addEventListener("submit", async (e) => {\n        e.preventDefault();\n\n        const formData = new FormData(form);\n        const email = formData.get("email");\n        const password = formData.get("password");\n\n        const res = await fetch("/api/login", {\n            method: "POST",\n            headers: {\n                "Content-Type": "application/json",\n            },\n            body: JSON.stringify({ email, password }),\n        });\n\n        const result = await res.json();\n\n        if (res.ok) {\n            localStorage.setItem("user", JSON.stringify(result.user));\n            window.location.href = "/";\n        } else {\n            alert(result.error || "Erreur de connexion");\n        }\n    });\n<\/script>'])), maybeRenderHead());
}, "C:/Users/mathi/github/projet-co-s2-2025-15_woodenladle/src/components/LoginForm.astro", void 0);

var __freeze = Object.freeze;
var __defProp = Object.defineProperty;
var __template = (cooked, raw) => __freeze(__defProp(cooked, "raw", { value: __freeze(raw || cooked.slice()) }));
var _a;
const $$Astro = createAstro();
const $$Login = createComponent(async ($$result, $$props, $$slots) => {
  const Astro2 = $$result.createAstro($$Astro, $$props, $$slots);
  Astro2.self = $$Login;
  let error = "";
  let success = "";
  let newPseudo = "";
  let newAvatarUrl = "";
  if (Astro2.request.method === "POST") {
    const formData = await Astro2.request.formData();
    if (formData.get("action") === "update-profile") {
      try {
        const id = formData.get("id");
        const pseudo = formData.get("pseudo");
        const avatar = formData.get("avatar");
        const userData = {};
        if (pseudo) userData.pseudo = pseudo;
        if (avatar && avatar.size > 0) userData.avatar = avatar;
        const updated = await updateUser(id, userData);
        success = "Profil mis \xE0 jour !";
        newPseudo = updated.pseudo || "";
        newAvatarUrl = updated.avatar ? `https://savoury-road.mathis-guellati.fr/api/files/users/${updated.id}/${updated.avatar}?thumb=100x100` : "";
      } catch (e) {
        error = "Erreur lors de la mise \xE0 jour du profil.";
      }
    }
    if (formData.get("action") === "delete-account") {
      try {
        await deleteUser(formData.get("id"));
        success = "Compte supprim\xE9 !";
      } catch (e) {
        error = "Erreur lors de la suppression du compte.";
      }
    }
  }
  return renderTemplate`${renderComponent($$result, "Layout", $$Layout, {}, { "default": async ($$result2) => renderTemplate(_a || (_a = __template([" ", '<div class="flex flex-col gap-6 text-black"> <div id="login-title" class="w-full h-[250px] bg-gray-100 p-0 rounded-b-3xl flex items-center justify-center border-b"> <h1 class="text-[80px] font-lilitaone pt-20 text-white [-webkit-text-stroke:1px_black]">\nSe connecter\n</h1> </div> <div id="login-section" class="mt-20 mb-10"> ', ' </div> <div id="connected-section" class="w-full hidden mt-10 flex flex-col mx-auto gap-6"> <div class="h-[250px] bg-gray-100 p-0 rounded-b-3xl flex items-center justify-center border-b"> <h1 class="text-[80px] font-lilitaone pt-20 text-white [-webkit-text-stroke:1px_black]">\nMon compte\n</h1> </div> <div class="mx-auto mt-10 space-y-10"> <img id="connected-avatar" class="w-24 h-24 mx-auto rounded-full border"> <div class="space-y-4"> <p id="connected-email" class="font-lilitaone text-xl"></p> <p id="connected-pseudo" class="font-montserrat"></p> </div> </div> <button id="logout-btn" class="mt-10 font-lilitaone uppercase text-lg border-red-600 text-red-600 hover:bg-red-600 hover:text-white hover:w-[300px] transition-all cursor-pointer mx-auto rounded-xl border-3 flex justify-center items-center h-[50px] w-[250px]">\nSe d\xE9connecter\n</button> <form id="delete-account-form" method="POST" style="display:none;"> <input type="hidden" name="action" value="delete-account"> <input type="hidden" name="id" id="delete-user-id"> </form> <button id="delete-account-btn" class="font-lilitaone uppercase text-lg border-red-800 text-red-800 hover:bg-red-800 hover:text-white hover:w-[300px] transition-all cursor-pointer mx-auto rounded-xl border-3 flex justify-center items-center h-[50px] w-[250px]">\nSupprimer mon compte\n</button> </div> <div class="flex justify-center w-full my-4"> ', " ", ' </div> </div> <script is:browser>\n        window.addEventListener("DOMContentLoaded", () => {\n            const user = JSON.parse(localStorage.getItem("user"));\n            const loginSection = document.getElementById("login-section");\n            const loginTitle = document.getElementById("login-title");\n            const connectedSection = document.getElementById("connected-section");\n            const connectedEmail = document.getElementById("connected-email");\n            const connectedPseudo = document.getElementById("connected-pseudo");\n            const connectedAvatar = document.getElementById("connected-avatar");\n            const logoutBtn = document.getElementById("logout-btn");\n            const deleteAccountBtn = document.getElementById("delete-account-btn");\n            const deleteAccountForm = document.getElementById("delete-account-form");\n            const deleteUserId = document.getElementById("delete-user-id");\n\n            // Formulaire de maj du profil\n            const profileForm = document.getElementById("profile-form");\n            const pseudoInput = document.getElementById("pseudo-input");\n            const profileUserId = document.getElementById("profile-user-id");\n\n            if (user?.email) {\n                // Affichage connect\xE9\n                loginSection.classList.add("hidden");\n                connectedSection.classList.remove("hidden");\n                loginTitle.classList.add("hidden");\n\n                connectedEmail.textContent = "Connect\xE9 en tant que : " + user.email;\n                connectedPseudo.textContent = "Nom d\'utilisateur : " + user.pseudo;\n                if (user.avatar) {\n                    connectedAvatar.src = `https://savoury-road.mathis-guellati.fr/api/files/users/${user.id}/${user.avatar}?thumb=100x100`;\n                }\n                if (user.pseudo && pseudoInput) {\n                    pseudoInput.value = user.pseudo;\n                }\n                if (profileUserId) {\n                    profileUserId.value = user.id;\n                }\n\n                // D\xE9connexion\n                logoutBtn.addEventListener("click", () => {\n                    localStorage.removeItem("user");\n                    window.location.reload();\n                });\n\n                deleteAccountBtn.addEventListener("click", () => {\n                    const confirmed = confirm("Es-tu s\xFBr de vouloir supprimer ton compte ?");\n                    if (!confirmed) return;\n                    deleteUserId.value = user.id;\n                    deleteAccountForm.submit();\n                });\n            }\n        });\n    <\/script> '], [" ", '<div class="flex flex-col gap-6 text-black"> <div id="login-title" class="w-full h-[250px] bg-gray-100 p-0 rounded-b-3xl flex items-center justify-center border-b"> <h1 class="text-[80px] font-lilitaone pt-20 text-white [-webkit-text-stroke:1px_black]">\nSe connecter\n</h1> </div> <div id="login-section" class="mt-20 mb-10"> ', ' </div> <div id="connected-section" class="w-full hidden mt-10 flex flex-col mx-auto gap-6"> <div class="h-[250px] bg-gray-100 p-0 rounded-b-3xl flex items-center justify-center border-b"> <h1 class="text-[80px] font-lilitaone pt-20 text-white [-webkit-text-stroke:1px_black]">\nMon compte\n</h1> </div> <div class="mx-auto mt-10 space-y-10"> <img id="connected-avatar" class="w-24 h-24 mx-auto rounded-full border"> <div class="space-y-4"> <p id="connected-email" class="font-lilitaone text-xl"></p> <p id="connected-pseudo" class="font-montserrat"></p> </div> </div> <button id="logout-btn" class="mt-10 font-lilitaone uppercase text-lg border-red-600 text-red-600 hover:bg-red-600 hover:text-white hover:w-[300px] transition-all cursor-pointer mx-auto rounded-xl border-3 flex justify-center items-center h-[50px] w-[250px]">\nSe d\xE9connecter\n</button> <form id="delete-account-form" method="POST" style="display:none;"> <input type="hidden" name="action" value="delete-account"> <input type="hidden" name="id" id="delete-user-id"> </form> <button id="delete-account-btn" class="font-lilitaone uppercase text-lg border-red-800 text-red-800 hover:bg-red-800 hover:text-white hover:w-[300px] transition-all cursor-pointer mx-auto rounded-xl border-3 flex justify-center items-center h-[50px] w-[250px]">\nSupprimer mon compte\n</button> </div> <div class="flex justify-center w-full my-4"> ', " ", ' </div> </div> <script is:browser>\n        window.addEventListener("DOMContentLoaded", () => {\n            const user = JSON.parse(localStorage.getItem("user"));\n            const loginSection = document.getElementById("login-section");\n            const loginTitle = document.getElementById("login-title");\n            const connectedSection = document.getElementById("connected-section");\n            const connectedEmail = document.getElementById("connected-email");\n            const connectedPseudo = document.getElementById("connected-pseudo");\n            const connectedAvatar = document.getElementById("connected-avatar");\n            const logoutBtn = document.getElementById("logout-btn");\n            const deleteAccountBtn = document.getElementById("delete-account-btn");\n            const deleteAccountForm = document.getElementById("delete-account-form");\n            const deleteUserId = document.getElementById("delete-user-id");\n\n            // Formulaire de maj du profil\n            const profileForm = document.getElementById("profile-form");\n            const pseudoInput = document.getElementById("pseudo-input");\n            const profileUserId = document.getElementById("profile-user-id");\n\n            if (user?.email) {\n                // Affichage connect\xE9\n                loginSection.classList.add("hidden");\n                connectedSection.classList.remove("hidden");\n                loginTitle.classList.add("hidden");\n\n                connectedEmail.textContent = "Connect\xE9 en tant que : " + user.email;\n                connectedPseudo.textContent = "Nom d\'utilisateur : " + user.pseudo;\n                if (user.avatar) {\n                    connectedAvatar.src = \\`https://savoury-road.mathis-guellati.fr/api/files/users/\\${user.id}/\\${user.avatar}?thumb=100x100\\`;\n                }\n                if (user.pseudo && pseudoInput) {\n                    pseudoInput.value = user.pseudo;\n                }\n                if (profileUserId) {\n                    profileUserId.value = user.id;\n                }\n\n                // D\xE9connexion\n                logoutBtn.addEventListener("click", () => {\n                    localStorage.removeItem("user");\n                    window.location.reload();\n                });\n\n                deleteAccountBtn.addEventListener("click", () => {\n                    const confirmed = confirm("Es-tu s\xFBr de vouloir supprimer ton compte ?");\n                    if (!confirmed) return;\n                    deleteUserId.value = user.id;\n                    deleteAccountForm.submit();\n                });\n            }\n        });\n    <\/script> '])), maybeRenderHead(), renderComponent($$result2, "LoginForm", $$LoginForm, {}), success && renderTemplate`<p class="text-green-600">${success}</p>`, error && renderTemplate`<p class="text-red-600">${error}</p>`) })}`;
}, "C:/Users/mathi/github/projet-co-s2-2025-15_woodenladle/src/pages/login.astro", void 0);

const $$file = "C:/Users/mathi/github/projet-co-s2-2025-15_woodenladle/src/pages/login.astro";
const $$url = "/login";

const _page = /*#__PURE__*/Object.freeze(/*#__PURE__*/Object.defineProperty({
    __proto__: null,
    default: $$Login,
    file: $$file,
    url: $$url
}, Symbol.toStringTag, { value: 'Module' }));

const page = () => _page;

export { page };
